<!--
 * Copyright (c) 2014 IBM Corp.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * and Eclipse Distribution License v1.0 which accompany this distribution.
 *
 * The Eclipse Public License is available at
 *   http://www.eclipse.org/legal/epl-v10.html
 * and the Eclipse Distribution License is available at
 *   http://www.eclipse.org/org/documents/edl-v10.php.
 *
 * Contributors:
 *   Bryan Boyd - Initial implementation 
 -->

<!DOCTYPE html>
<html>
<head>
  <title>IoT Phone</title>
  <link rel='stylesheet' href='/stylesheets/device.css'/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
	<script type="text/javascript">
		window.deviceId = "myphone";
	</script>

	<script>
var px = 50; // Position x and y
var py = 50;
var vx = 0.0; // Velocity x and y
var vy = 0.0;
var updateRate = 1/60; // Sensor refresh rate

function getAccel(){
    DeviceMotionEvent.requestPermission().then(response => {
        if (response == 'granted') {
       // Add a listener to get smartphone orientation 
           // in the alpha-beta-gamma axes (units in degrees)
           /* window.addEventListener('deviceorientation',(event) => {
                // Expose each orientation angle in a more readable way
                rotation_degrees = event.alpha;
                frontToBack_degrees = event.beta;
                leftToRight_degrees = event.gamma;
                
                // Update velocity according to how tilted the phone is
                // Since phones are narrower than they are long, double the increase to the x velocity
                vx = vx + leftToRight_degrees * updateRate*2; 
                vy = vy + frontToBack_degrees * updateRate;
                
                // Update position and clip it to bounds
                px = px + vx*.5;
                if (px > 98 || px < 0){ 
                    px = Math.max(0, Math.min(98, px)) // Clip px between 0-98
                    vx = 0;
                }

                py = py + vy*.5;
                if (py > 98 || py < 0){
                    py = Math.max(0, Math.min(98, py)) // Clip py between 0-98
                    vy = 0;
                }
                
                dot = document.getElementsByClassName("indicatorDot")[0]
                dot.setAttribute('style', "left:" + (px) + "%;" +
                                              "top:" + (py) + "%;");
                
            });*/
			console.log("Acceleration granted");
        }
    });
}
	</script>

<script type="text/javascript">
	getAccel();
</script>

	<div class="outer-main">
			<!-- <button id="accelPermsButton"  style="height:50px;" onclick="getAccel()"><h1>Get Accelerometer Permissions</h1></button> -->
	
			<h1>Your device ID:</h1>
			<h2><span id="deviceId"></span></h2>
			<p style="padding-top:10px">
    			<img id="connectionImage" src="/images/disconnected.svg" class="iot-connected-image" style="vertical-align:middle">
    			<span id="connection">Disconnected</span>
			</p>â€‹
			<h3>Published Messages: <span id='msgCount'></h3>
		</div>
		<div class="main">
			<table class="data-table">
				<tr class="table-title">
					<th colspan="3">Movement</th>
				</tr>
				<tr class="data-title">
					<th>Alpha</th>
					<th>Beta</th>
					<th>Gamma</th>
				</tr>
				<tr>
					<td id="alpha">0</td>
					<td id="beta">0</td>
					<td id="gamma">0</td>
				</tr>
			</table>
			<table class="data-table">
				<tr class="table-title">
					<th colspan="3">Acceleration</th>
				</tr>
				<tr class="data-title">
					<th>X</th>
					<th>Y</th>
					<th>Z</th>
				</tr>
				<tr>
					<td id="accx">0</td>
					<td id="accy">0</td>
					<td id="accz">0</td>
				</tr>
			</table>
			<table class="data-table">
				<tr class="table-title">
					<th colspan="2">Location</th>
				</tr>
				<tr class="data-title">
					<th>Latitude</th>
					<th>Longitude</th>
				</tr>
				<tr>
					<td id="lat">0</td>
					<td id="lng">0</td>
				</tr>
			</table>
		</div>
		<div class="iot-footer-pad"></div>
	</div>
	<!-- Please do not change the order of these links as some depend on each other -->
	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<script type="text/javascript" src="/js/mqttws31.js"></script>
	<script type="text/javascript" src="/js/device.js"></script>
</body>
</html>
